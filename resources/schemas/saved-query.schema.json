{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "SavedQuery",
    "description": "Schema for saving and retrieving user query state including SQL query and chart configuration",
    "type": "object",
    "properties": {
      "guid": {
        "type": "string",
        "description": "Unique identifier for the saved query",
        "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
      },
      "name": {
        "type": "string",
        "description": "User-friendly name for the saved query",
        "minLength": 1,
        "maxLength": 100
      },
      "description": {
        "type": "string",
        "description": "Optional description of the saved query",
        "maxLength": 500
      },
      "sqlText": {
        "type": "string",
        "description": "The SQL query text",
        "minLength": 1
      },
      "chartConfig": {
        "type": "object",
        "description": "Chart configuration settings",
        "properties": {
          "chart_type": {
            "type": "string",
            "enum": ["line", "bar", "area", "scatter"],
            "description": "Type of chart to display"
          },
          "x_key": {
            "type": "string",
            "description": "Column name for X-axis"
          },
          "y_key": {
            "type": "string",
            "description": "Column name for Y-axis"
          },
          "series_key": {
            "type": "string",
            "description": "Column name for series differentiation"
          },
          "series": {
            "type": "array",
            "description": "Array of series configurations",
            "items": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["line", "bar", "area", "scatter", "pie"]
                },
                "xKey": {
                  "type": "string"
                },
                "yKey": {
                  "type": "string"
                },
                "seriesValue": {
                  "type": "string",
                  "description": "Value for this specific series"
                }
              },
              "required": ["type", "xKey", "yKey"]
            }
          },
          "filteredData": {
            "type": "array",
            "description": "Filtered dataset based on selected series values",
            "items": {
              "type": "object",
              "description": "Row data object"
            }
          },
          "selectedSeriesValues": {
            "type": "array",
            "description": "Array of selected series values for filtering",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["chart_type", "x_key", "y_key"]
      },
      "isPublic": {
        "type": "boolean",
        "description": "Whether this saved query is visible to other users",
        "default": false
      }
    },
    "required": ["guid", "name", "sqlText"],
    "additionalProperties": false
  }